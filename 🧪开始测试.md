# 🧪 开始测试 FHE 双合约游戏

## ✅ 前端已启动！

前端服务器正在后台运行...

**访问地址**: http://localhost:5173

---

## 🎯 测试步骤

### 准备工作 ✅

1. **打开浏览器**
   - 访问: http://localhost:5173
   - 推荐使用 Chrome 或 Edge

2. **准备两个钱包**
   - 房主钱包（你当前的）
   - 玩家钱包（另一个测试钱包）

3. **确保 Sepolia 测试币充足**
   - 每个钱包至少 0.01 ETH
   - 获取测试币: https://sepoliafaucet.com/

---

## 🎮 测试方案 B（明文版）- 快速体验

### 第一步：连接钱包（房主）

1. 点击右上角 "连接钱包"
2. 选择 MetaMask
3. 确认连接
4. ✅ 看到钱包地址显示

### 第二步：选择合约

在页面顶部看到：

```
┌────────────────────────────────────┐
│ [📝 方案B (明文)]  [🔐 方案A (FHE)] │
└────────────────────────────────────┘
```

**点击 "📝 方案B (明文)"**

### 第三步：创建游戏

1. 点击 "➕ 创建游戏"
2. 填写信息：
   - 🎯 目标数字: `50` (1-100之间)
   - 💰 入场费: `0.001` ETH
3. 点击 "创建游戏"
4. MetaMask 弹出 → 确认交易
5. ⏳ 等待交易确认（约10-30秒）
6. ✅ 看到 "游戏创建成功！游戏 ID: 1"

### 第四步：用另一个钱包加入游戏

1. 打开**另一个浏览器**（或无痕模式）
2. 访问: http://localhost:5173
3. 连接**另一个钱包**
4. 确保选择 "📝 方案B"
5. 在游戏列表中看到游戏 #1
6. 点击游戏 #1
7. 点击 "🎯 加入游戏 #1"
8. 输入猜测：`45` (1-100之间)
9. 点击 "提交猜测"
10. MetaMask 确认交易
11. ✅ 看到 "成功加入游戏！"

### 第五步：查看游戏详情

在**两个浏览器**中都可以：
1. 点击 "📊 游戏详情 #1"
2. 看到：
   - 🎯 目标数字: **50** (明文可见)
   - 👥 参与玩家: 2人
   - 📝 玩家猜测: **45** (明文可见)
   - 💰 奖池: 0.002 ETH

### 第六步：结束游戏（房主操作）

1. 回到**房主浏览器**
2. 在游戏详情页
3. 点击 "🏁 结束游戏"
4. 确认弹窗
5. MetaMask 确认交易
6. ⏳ 等待交易确认
7. ✅ **立即看到结果**：
   - 🏆 获胜者: 玩家地址
   - 🎯 目标数字: 50
   - 📊 差值: 5
   - 💰 奖金已转账

### ✅ 方案B测试完成！

---

## 🔐 测试方案 A（FHE版）- 完全隐私

### 第一步：切换到 FHE 模式

在页面顶部：
**点击 "🔐 方案A (FHE)"**

游戏列表会自动刷新（显示FHE合约的游戏）

### 第二步：创建 FHE 游戏（房主）

1. 点击 "➕ 创建游戏"
2. 注意页面显示：**(🔐 FHE 模式)**
3. 填写信息：
   - 🎯 目标数字: `75` (1-100之间)
   - 💰 入场费: `0.001` ETH （建议 ≥ 0.001）
4. 点击 "创建游戏"
5. 📝 注意提示：
   ```
   🔐 这个数字将被 FHE 完全加密，游戏进行中完全保密
   ```
6. MetaMask 弹出 → **确认交易**
7. ⏳ 等待确认（FHE交易可能需要更长时间，约30-60秒）
8. ✅ 看到 "游戏创建成功！"

### 第三步：加入 FHE 游戏（玩家）

1. 在**另一个浏览器**
2. 切换到 "🔐 方案A (FHE)"
3. 看到游戏列表（FHE游戏）
4. 点击游戏
5. 点击 "🎯 加入游戏"
6. 输入猜测：`70`
7. 📝 注意提示：
   ```
   🔐 你的猜测将被 FHE 完全加密，游戏进行中完全保密
   ```
8. 点击 "提交猜测"
9. MetaMask 确认交易
10. ⏳ 等待确认（约30-60秒）
11. ✅ 看到 "成功加入游戏！"

### 第四步：观察加密状态

在**游戏详情**页面，注意看到：

**游戏进行中（ACTIVE）：**
```
🎯 目标数字: 🔐 已加密（游戏结束后显示）
👥 参与玩家:
   - 玩家1: 🔐 加密中
```

**这就是 FHE 的魅力 - 数据完全保密！**

### 第五步：结束 FHE 游戏（房主）

1. 回到**房主浏览器**
2. 点击 "🏁 结束游戏"
3. MetaMask 确认交易
4. ⏳ 等待交易确认

### 第六步：⭐ 观察 Gateway 解密过程

交易确认后，页面显示：

```
┌─────────────────────────────────────────┐
│ 🔄 Gateway 正在解密中...                  │
│ 预计需要 5-15 秒，请稍候。                │
│ 解密完成后将自动显示结果。                 │
└─────────────────────────────────────────┘
```

**状态变为**: `🔄 正在解密...`

### 第七步：查看解密结果

等待 5-15 秒后，页面自动更新：

```
✅ 游戏已结束！

🏆 获胜者: 0x...（玩家地址）
🎯 目标数字: 75  ← 现在解密了！
📊 猜测: 70     ← 现在可见了！
📊 差值: 5
💰 奖金: 0.002 ETH（已自动转账）
```

### ✅ 方案A测试完成！

---

## 🔍 验证隐私性

### 在 Etherscan 上验证加密

1. **复制任意 FHE 交易哈希**

2. **访问 Sepolia Etherscan**
   ```
   https://sepolia.etherscan.io/tx/YOUR_TX_HASH
   ```

3. **查看 Input Data**

#### 方案B（明文）示例：
```
Method ID: 0x12345678
[0]: 0000000000000000000000000000000000000000000000000000000000000032
     ↑ 这是十六进制的 50 (明文可见！)
```

#### 方案A（FHE）示例：
```
Method ID: 0xabcdef12
[0]: a7f3b2c8e9d4f1a6b8c2d5e7f9... (大量随机字节)
[1]: 9f8e2d1c3b5a7f4e6d8c... (proof 数据)
     ↑ 完全无法看出原始数字！✅
```

---

## 📊 预期结果对比

| 测试项 | 方案B (明文) | 方案A (FHE) |
|--------|-------------|-------------|
| 创建游戏速度 | ⚡ 快 (~15秒) | 🐢 慢 (~30-60秒) |
| Gas 成本 | 💚 低 (~150k) | 💛 高 (~850k) |
| 游戏中数据可见性 | ❌ 完全可见 | ✅ 完全加密 |
| 结束游戏后 | ⚡ 立即显示 | ⏱️ 需要5-15秒解密 |
| Etherscan 数据 | ❌ 明文可见 | ✅ 完全加密 |

---

## ⚠️ 常见问题

### 1. 前端无法访问？
```cmd
# 检查服务是否运行
netstat -ano | findstr :5173

# 如果没有运行，手动启动
cd frontend
npm run dev
```

### 2. MetaMask 交易失败？
- 检查网络是否为 Sepolia
- 检查余额是否充足
- 尝试增加 Gas Limit

### 3. FHE 解密超时？
- 继续等待（可能需要1-2分钟）
- 刷新页面查看状态
- 查看合约事件日志

### 4. 看不到游戏列表？
- 检查是否连接钱包
- 检查是否选对合约版本
- 点击 "🔄 刷新" 按钮

---

## 🎯 测试检查清单

### 方案B（明文）测试
- [ ] 成功连接钱包
- [ ] 成功创建游戏
- [ ] 另一个钱包成功加入
- [ ] 游戏中可以看到目标数字
- [ ] 游戏中可以看到玩家猜测
- [ ] 成功结束游戏
- [ ] 获胜者收到奖金
- [ ] Etherscan 显示明文数据

### 方案A（FHE）测试
- [ ] 成功切换到 FHE 模式
- [ ] 成功创建 FHE 游戏
- [ ] 另一个钱包成功加入
- [ ] 游戏中**看不到**目标数字（显示🔐）
- [ ] 游戏中**看不到**猜测（显示🔐）
- [ ] 成功结束游戏
- [ ] 看到 "正在解密" 提示
- [ ] 解密完成后显示明文结果
- [ ] 获胜者收到奖金
- [ ] Etherscan 显示加密数据

---

## 🎉 测试成功标志

### 全部完成后，你应该：

✅ 理解了明文和加密的区别  
✅ 体验了 FHE 的完全隐私  
✅ 看到了 Gateway 自动解密  
✅ 验证了链上数据确实被加密  
✅ 掌握了 Zama FHEVM 的使用  

---

## 📸 截图建议

建议截图保存以下场景：

1. ✅ 游戏列表页面
2. ✅ 创建游戏页面（两个版本）
3. ✅ 游戏详情 - 进行中（对比加密状态）
4. ✅ 解密中提示
5. ✅ 游戏结束后的结果
6. ✅ Etherscan 上的加密数据

---

## 💬 测试完成后

### 如果成功 🎉
恭喜！你已经成功测试了完整的 FHE DApp！

**分享你的体验：**
- 哪个功能最让你印象深刻？
- FHE 解密速度是否在预期内？
- 有什么改进建议？

### 如果遇到问题 ⚠️
请提供以下信息：
- 在哪一步遇到问题
- 错误消息截图
- 浏览器控制台日志
- 交易哈希（如果有）

---

**现在开始测试吧！** 🚀

1. 打开浏览器
2. 访问 http://localhost:5173
3. 按照上面的步骤操作

Good Luck! 🎮✨


