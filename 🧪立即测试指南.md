# 🧪 立即测试指南 - 自动 Fallback 功能

## ⚡ 快速开始（60秒测试）

### 第 1 步：打开应用
```
✅ 前端服务器已运行：http://localhost:5173/
✅ 直接打开浏览器访问
```

### 第 2 步：观察状态徽章
在页面顶部，你会看到以下之一：

#### 情况 A：Gateway 在线 ✅
```
🛡️ FHE 加密在线 (绿色背景)
当前: 方案A (FHE)
🤖 自动
```

#### 情况 B：Gateway 离线（当前最可能）⚠️
```
⚠️ Fallback 模式 (橙色背景)
当前: 方案B (明文)
🤖 自动
```

### 第 3 步：打开浏览器控制台（F12）
查看日志输出：

```javascript
🚀 启动 Gateway 健康检查...
🔍 检测 Gateway 状态: https://gateway.sepolia.zama.ai/public_key
⚠️ Gateway 不可用: [错误信息]
📡 Gateway 状态更新: down
⚠️ Gateway 离线，使用 Fallback 模式
⏱️ Gateway 轮询已启动（60秒间隔）
```

---

## 🎯 测试场景

### 测试 1: 点击状态徽章展开详情
1. 点击页面顶部的状态徽章
2. **应该看到：**
   - 状态说明
   - 当前合约信息（地址）
   - 自动切换控制开关
   - 轮询提示

### 测试 2: 测试游戏功能（Fallback 模式）
当前最可能处于 Fallback 模式，测试一下：

1. **创建游戏**
   - 点击"创建游戏"
   - 输入目标数字和入场费
   - 点击提交
   - ✅ 应该成功创建

2. **查看游戏列表**
   - 左侧应该显示游戏列表
   - ✅ 显示合约地址：0x6bD042...377e

3. **加入游戏**
   - 选择一个游戏
   - 输入猜测数字
   - ✅ 应该成功加入

### 测试 3: 切换到手动模式
1. 点击状态徽章展开
2. 找到"自动切换"部分
3. 点击"禁用"按钮
4. **应该看到：**
   - 模式标签变为：👆 手动
   - 仍然可以手动选择合约

### 测试 4: 手动切换合约
1. 在合约选择器中点击"方案A"或"方案B"
2. **应该看到：**
   - 合约立即切换
   - 控制台输出：👆 手动切换合约: [类型]
   - 游戏列表刷新

### 测试 5: 重新启用自动模式
1. 点击状态徽章
2. 点击"启用"按钮
3. **应该看到：**
   - 模式标签变回：🤖 自动
   - 系统根据 Gateway 状态自动调整

---

## 📊 预期的控制台日志

### 启动时（Gateway 离线）
```
🚀 启动 Gateway 健康检查...
🔍 检测 Gateway 状态: https://gateway.sepolia.zama.ai/public_key
⚠️ Gateway 不可用: Failed to fetch / 403 Forbidden
📡 Gateway 状态更新: down
⚠️ Gateway 离线，使用 Fallback 模式
⏱️ Gateway 轮询已启动（60秒间隔）
```

### 定时轮询（每 60 秒）
```
🔍 检测 Gateway 状态: https://gateway.sepolia.zama.ai/public_key
⚠️ Gateway 不可用: [错误信息]
📡 Gateway 状态更新: down
```

### 如果 Gateway 恢复（理论上）
```
🔍 检测 Gateway 状态: https://gateway.sepolia.zama.ai/public_key
✅ Gateway 在线
🔄 Gateway 恢复，自动切换到 FHE 模式
📡 Gateway 状态更新: up
```

---

## ✅ 成功标志

你应该看到以下所有内容：

1. ✅ 页面顶部有状态徽章（橙色或绿色）
2. ✅ 可以点击展开查看详情
3. ✅ 控制台有详细的健康检查日志
4. ✅ 游戏功能正常工作（使用方案B）
5. ✅ 可以切换自动/手动模式
6. ✅ 每 60 秒看到新的检查日志

---

## 🎯 核心验证点

### ✅ 自动 Fallback 已生效

**证据 1：** 看到 "⚠️ Fallback 模式" 徽章  
**证据 2：** 控制台显示 "Gateway 离线，使用 Fallback 模式"  
**证据 3：** 游戏功能仍然完全可用  
**证据 4：** 每 60 秒自动检测 Gateway  

### ✅ 双合约架构正常工作

**证据 1：** 可以在方案A和方案B之间切换  
**证据 2：** 不同合约显示不同的地址  
**证据 3：** 两个合约都可以正常使用  

### ✅ 状态管理系统正常

**证据 1：** 状态徽章实时更新  
**证据 2：** 自动/手动模式可切换  
**证据 3：** 所有状态变化都有日志  

---

## 🐛 如果遇到问题

### 问题 1：没有看到状态徽章
**检查：** 浏览器是否显示 http://localhost:5173/  
**解决：** 刷新页面（Ctrl + F5 硬刷新）

### 问题 2：控制台没有日志
**检查：** 是否打开了控制台（F12）  
**解决：** 确保在 Console 标签页

### 问题 3：显示 "检测中..."
**等待：** 初始检查需要 5 秒  
**如果超过 10 秒：** 刷新页面

### 问题 4：游戏功能不工作
**检查：** 是否连接了钱包  
**检查：** 控制台是否有其他错误  
**解决：** 查看完整错误信息

---

## 🎉 测试完成！

如果你看到了：
- ✅ 状态徽章显示正常
- ✅ 控制台有健康检查日志
- ✅ 游戏功能可以使用
- ✅ 自动轮询在工作

**恭喜！自动 Fallback 功能完美运行！** 🚀

---

## 💡 接下来做什么？

### 现在你可以：

1. **正常使用方案B**
   - 创建游戏、加入游戏、结束游戏
   - 完全不受 Gateway 问题影响

2. **观察自动切换**
   - 等待 Gateway 恢复（如果会恢复的话）
   - 系统会自动切换回 FHE 模式

3. **展示给他人**
   - 这是一个企业级的容错设计
   - 值得在项目演示中展示

4. **继续开发**
   - 添加更多游戏功能
   - 优化用户界面
   - 完善游戏逻辑

---

**一切都按计划工作！尽情享受吧！** ✨


